# 最簡化的 Traefik 配置 - 直接路由，不做任何修改
# 如果這個還不行，我們就換掉 Traefik

apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: n8n-direct-route
  namespace: fullstack-app
spec:
  entryPoints:
    - web
    - websecure
  routes:
  # 直接路由所有 n8n 請求，不做任何處理
  - match: Host(`REPLACE_WITH_YOUR_DOMAIN`)
    kind: Rule
    priority: 100
    services:
    - name: n8n-service
      port: 80
    middlewares:
    - name: sse-only-headers

---
# 只設置必要的 SSE headers，不做路徑處理
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: sse-only-headers
  namespace: fullstack-app
spec:
  headers:
    customResponseHeaders:
      Cache-Control: "no-cache"
      Connection: "keep-alive"
      Access-Control-Allow-Origin: "*"
